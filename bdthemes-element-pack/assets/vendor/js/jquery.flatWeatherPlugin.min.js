//flatWeatherJqueryPlugin min
//2017-05-25 v1.3
!function(t,e,s,a){function i(e,s){this.element=e,this.settings=t.extend({},p,s),this.settings.units&&"auto"!=this.settings.units||(this.settings.units=-1==["united states","usa","united states of america","us"].indexOf(this.settings.country.toLowerCase())?"metric":"imperial"),this.settings.forecast=Math.min(this.settings.forecast,5),"wunderground"==this.settings.api&&(this.settings.forecast=Math.min(this.settings.forecast,3)),this._name=c,this.once=!1,this.init()}function o(t,e){var s={};if("openweathermap"==e.api){""!=t[0].name?(s.location=t[0].name+", "+t[0].sys.country,s.city=t[0].name):""!=t[1].city.name?(s.location=t[1].city.name+", "+t[1].city.country,s.city=t[1].city.name):(s.location=e.location+", "+e.country,s.city=e.location),s.today={},s.today.temp={},s.today.temp.now=Math.round(t[0].main.temp),s.today.temp.min=Math.round(t[0].main.temp_min),s.today.temp.max=Math.round(t[0].main.temp_max),s.today.desc=t[0].weather[0].description.capitalize(),s.today.code=t[0].weather[0].id,s.today.wind=t[0].wind,s.today.humidity=t[0].main.humidity,s.today.pressure=t[0].main.pressure,s.today.sunrise=r(t[0].sys.sunrise,e.timeformat),s.today.sunset=r(t[0].sys.sunset,e.timeformat),s.today.day=n(new Date,e.strings.days),s.forecast=[];for(c=0;c<e.forecast;c++)(p={}).day=n(new Date(1e3*t[1].list[c].dt),e.strings.days),p.code=t[1].list[c].weather[0].id,p.desc=t[1].list[c].weather[0].description.capitalize(),p.temp={max:Math.round(t[1].list[c].temp.max),min:Math.round(t[1].list[c].temp.min)},s.forecast.push(p)}else if("yahoo"==e.api){a={0:"900",1:"901",2:"902",3:"212",4:"200",5:"616",6:"612",7:"611",8:"511",9:"301",10:"511",11:"521",12:"521",13:"600",14:"615",15:"601",16:"601",17:"906",18:"611",19:"761",20:"741",21:"721",22:"711",23:"956",24:"954",25:"903",26:"802",27:"802",28:"802",29:"802",30:"802",31:"800",32:"800",33:"951",34:"951",35:"906",36:"904",37:"210",38:"210",39:"210",40:"521",41:"602",42:"621",43:"602",44:"802",45:"201",46:"621",47:"210",3200:"951"};t=t.query.results.channel,s.location=t.location.city+", "+t.location.country,s.city=t.location.city,s.today={},s.today.temp={},s.today.temp.now=Math.round(t.item.condition.temp),s.today.temp.min=Math.round(t.item.forecast[0].low),s.today.temp.max=Math.round(t.item.forecast[0].high),s.today.desc=t.item.condition.text.capitalize(),s.today.code=a[t.item.condition.code],s.today.wind={},s.today.wind.speed=t.wind.speed,s.today.wind.deg=t.wind.direction,s.today.humidity=t.atmosphere.humidity,s.today.pressure=t.atmosphere.pressure,"12"==e.timeformat?(s.today.sunrise=t.astronomy.sunrise.toUpperCase(),s.today.sunset=t.astronomy.sunset.toUpperCase()):(s.today.sunrise=0+t.astronomy.sunrise.match(/\d+/)[0]+t.astronomy.sunrise.match(/:\d+/)[0],s.today.sunset=parseInt(t.astronomy.sunset.match(/\d+/)[0])+12+t.astronomy.sunset.match(/:\d+/)[0]),s.today.day=n(new Date,e.strings.days),s.forecast=[];for(c=0;c<e.forecast;c++)(p={}).day=n(new Date(t.item.forecast[c].date),e.strings.days),p.code=a[t.item.forecast[c].code],p.desc=t.item.forecast[c].text.capitalize(),p.temp={max:Math.round(t.item.forecast[c].high),min:Math.round(t.item.forecast[c].low)},s.forecast.push(p)}else if("wunderground"==e.api){var a={chanceflurries:"600",chancerain:"500",chancesleet:"611",chancesnow:"600",chancetstorms:"200",clear:"800",cloudy:"802",flurries:"600",fog:"741",hazy:"721",mostlycloudy:"802",mostlysunny:"802",partlycloudy:"802",partlysunny:"802",sleet:"611",rain:"501",snow:"601",sunny:"800",tstorms:"211",unknown:"951"};s.location=t.current_observation.display_location.full,s.city=t.current_observation.display_location.city,s.today={},s.today.temp={},"metric"==e.units?(s.today.temp.now=Math.round(t.current_observation.temp_c),s.today.temp.min=Math.round(t.forecast.simpleforecast.forecastday[0].low.celsius),s.today.temp.max=Math.round(t.forecast.simpleforecast.forecastday[0].high.celsius)):(s.today.temp.now=Math.round(t.current_observation.temp_f),s.today.temp.min=Math.round(t.forecast.simpleforecast.forecastday[0].low.fahrenheit),s.today.temp.max=Math.round(t.forecast.simpleforecast.forecastday[0].high.fahrenheit)),s.today.desc=t.current_observation.weather,s.today.code=a[t.current_observation.icon],s.today.wind={},"metric"==e.units?s.today.wind.speed=t.current_observation.wind_kph:s.today.wind.speed=t.current_observation.wind_mph,s.today.wind.deg=t.current_observation.wind_degrees,s.today.humidity=t.current_observation.relative_humidity,"metric"==e.units?s.today.pressure=t.current_observation.pressure_mb:s.today.pressure=t.current_observation.pressure_in;var i=t.sun_phase.sunrise.minute,o=t.sun_phase.sunset.minute;if("12"==e.timeformat){s.today.sunrise=t.sun_phase.sunrise.hour+":"+i+" AM";var d=t.sun_phase.sunset.hour%12;d=d||12,s.today.sunset=d+":"+o+" PM"}else s.today.sunrise=t.sun_phase.sunrise.hour+":"+i,s.today.sunset=t.sun_phase.sunset.hour+":"+o;s.today.day=n(new Date,e.strings.days),s.forecast=[];for(var c=0;c<e.forecast+1;c++){var p={};p.day=n(new Date(1e3*t.forecast.simpleforecast.forecastday[c].date.epoch),e.strings.days),p.code=a[t.forecast.simpleforecast.forecastday[c].icon],p.desc=t.forecast.simpleforecast.forecastday[c].conditions,"metric"==e.units?p.temp={max:Math.round(t.forecast.simpleforecast.forecastday[c].high.celsius),min:Math.round(t.forecast.simpleforecast.forecastday[c].low.celsius)}:p.temp={max:Math.round(t.forecast.simpleforecast.forecastday[c].high.fahrenheit),min:Math.round(t.forecast.simpleforecast.forecastday[c].low.fahrenheit)},s.forecast.push(p)}}return s}function n(t,e){return e[t.getDay()]}function r(t,e){var s=(t=new Date(1e3*t)).getHours(),a=t.getMinutes(),i=s>=12?"PM":"AM";return"24"==e&&(i="",s=s<10?"0"+s:s),"12"==e&&(s%=12),(s=s||12)+":"+(a=a<10?"0"+a:a)+" "+i}function d(t,e,s,a){var i=e;return i>=0&&i<=11.25||i>348.75&&i<=360?i=a[0]:i>11.25&&i<=33.75?i=a[1]:i>33.75&&i<=56.25?i=a[2]:i>56.25&&i<=78.75?i=a[3]:i>78.75&&i<=101.25?i=a[4]:i>101.25&&i<=123.75?i=a[5]:i>123.75&&i<=146.25?i=a[6]:i>146.25&&i<=168.75?i=a[7]:i>168.75&&i<=191.25?i=a[8]:i>191.25&&i<=213.75?i=a[9]:i>213.75&&i<=236.25?i=a[10]:i>236.25&&i<=258.75?i=a[11]:i>258.75&&i<=281.25?i=a[12]:i>281.25&&i<=303.75?i=a[13]:i>303.75&&i<=326.25?i=a[14]:i>326.25&&i<=348.75&&(i=a[15]),i||(i=""),i+" "+t+" "+("metric"==s?"km/h":"mph")}var c="flatWeatherPlugin",p={location:"Boston, MA",country:"USA",zmw:"02108.1.99999",displayCityNameOnly:!1,api:"yahoo",forecast:5,apikey:"",view:"full",render:!0,loadingAnimation:!0,strings:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],min:"Min",max:"Max",direction:["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"]},timeformat:"12",lang:"EN"},l={openweathermap:["http://api.openweathermap.org/data/2.5/weather","http://api.openweathermap.org/data/2.5/forecast/daily"],yahoo:["https://query.yahooapis.com/v1/public/yql"],wunderground:["https://api.wunderground.com/api/apikey/conditions/forecast/astronomy/"]};t.extend(i.prototype,{init:function(){this.settings.render&&(this.settings.loadingAnimation&&!this.once&&(this.loading=t("<div/>",{id:"flatWeatherLoading",class:"wi loading"}),this.loading.appendTo(this.element)),this.fetchWeather().then(this.render,this.error)),this.once=!0},fetchWeather:function(){var e=this,s=new t.Deferred,a=[],i=this.settings.location+" "+this.settings.country;if("openweathermap"==this.settings.api){var n={};this.settings.lat&&this.settings.lon?(n.lat=this.settings.lat,n.lon=this.settings.lon):n.q=i,n.units=this.settings.units,this.settings.apikey&&(n.appid=this.settings.apikey),this.settings.lang&&(n.lang=this.settings.lang),a.push(n),n.cnt=this.settings.forecast+1,a.push(n)}else if("yahoo"==this.settings.api){var r="metric"==this.settings.units?"c":"f";(n={}).q="select * from weather.forecast where woeid in (select woeid from geo.places(1) where text='"+i+"') AND u='"+r+"'",n.env="store://datatables.org/alltableswithkeys",n.format="json",a.push(n)}else"wunderground"==this.settings.api&&(l[this.settings.api][0]=l[this.settings.api][0].replace(/apikey/,this.settings.apikey));for(var d=[],c=0;c<l[this.settings.api].length;c++)"wunderground"==this.settings.api?d.push(t.get(l[this.settings.api][c]+"lang:"+this.settings.lang+"/q/zmw:"+this.settings.zmw+".json")):d.push(t.get(l[this.settings.api][c],a[c]));return t.when.apply(this,d).done(function(){var a=Array.prototype.slice.call(arguments);if(a=d.length>1?a.map(function(t){return t[0]}):a[0],"openweathermap"!=e.settings.api||"200"==a[0].cod&&"200"==a[1].cod)if("yahoo"!=e.settings.api||0!=a.query.count&&"Yahoo! Weather Error"!=a.query.results.channel.description)if("wunderground"==e.settings.api&&a.response&&a.response.error)console.log("Error interacting with the wunderground api see error object below for details:"),console.log(a),s.reject(a,e);else{var i=o(a,e.settings);e._weather=i,t.data(e.element,"weather",i),s.resolve(i,e)}else console.log("Error interacting with the yahoo api see error object below for details:"),console.log(a),s.reject(a,e);else console.log("Error interacting with the openweathermap api see error object below for details:"),console.log(a),s.reject(a,e)}).fail(function(t){s.reject(t,e)}),s},error:function(e,s){s||(s=this),s.settings.loadingAnimation&&s.settings.render&&s.loading.remove(),"openweathermap"==s.settings.api?e="200"!=e.responseJSON.cod?e.responseJSON.cod+" "+e.responseJSON.message+" See console log for details.":e.responseJSON.message+" See console log for details.":"yahoo"==s.settings.api?e=e.query.results?"Error: "+e.query.results.channel.item.title+". See console log for details.":"Error: no results. See console log for details.":"wunderground"==s.settings.api&&(e=e.response.error.type+" See console log for details.");var a=t("<div/>",{class:"flatWeatherPlugin "+s.settings.view});return t("<h2/>").text("Error").appendTo(a),t("<p/>").text(e).appendTo(a),t(s.element).html(a),t(s.element)},render:function(e,s){s||(s=this,e=this._weather);var a="metric"==s.settings.units?"&#176;C":"&#176;F";s.settings.loadingAnimation&&s.settings.render&&s.loading.remove();var i=t("<div/>",{class:"flatWeatherPlugin "+s.settings.view});if(s.settings.displayCityNameOnly?t("<h2/>").text(e.city).appendTo(i):t("<h2/>").text(e.location).appendTo(i),"forecast"!=s.settings.view){var o=t("<div/>",{class:"wiToday"}),n=t("<div/>",{class:"wiIconGroup"});t("<div/>",{class:"wi wi"+e.today.code}).appendTo(n),t("<p/>",{class:"wiText"}).text(e.today.desc).appendTo(n),n.appendTo(o),t("<p/>",{class:"wiTemperature"}).html(e.today.temp.now+"<sup>"+a+"</sup>").appendTo(o),o.appendTo(i)}if("simple"!=s.settings.view){var r=t("<div/>",{class:"wiDetail"});if("partial"==s.settings.view&&t("<p/>",{class:"wiDay"}).text(e.today.day).appendTo(o),"partial"!=s.settings.view){"today"!=s.settings.view&&t("<p/>",{class:"wiDay"}).text(e.today.day).appendTo(r);var c=t("<ul/>",{class:"astronomy"}).appendTo(r);t("<li/>",{class:"wi sunrise"}).text(e.today.sunrise).appendTo(c),t("<li/>",{class:"wi sunset"}).text(e.today.sunset).appendTo(c);var p=t("<ul/>",{class:"temp"}).appendTo(r);t("<li/>").html(s.settings.strings.max+": "+e.today.temp.max+"<sup>"+a+"</sup>").appendTo(p),t("<li/>").html(s.settings.strings.min+": "+e.today.temp.min+"<sup>"+a+"</sup>").appendTo(p);var l=t("<ul/>",{class:"atmosphere"}).appendTo(r);t("<li/>",{class:"wi humidity"}).text(e.today.humidity).appendTo(l),t("<li/>",{class:"wi pressure"}).text(e.today.pressure).appendTo(l),t("<li/>",{class:"wi wind"}).text(d(e.today.wind.speed,e.today.wind.deg,s.settings.units,s.settings.strings.direction)).appendTo(l),r.appendTo(o)}if("today"!=s.settings.view||"forecast"==s.settings.view){for(var u=t("<ul/>",{class:"wiForecasts"}),h="forecast"==s.settings.view?0:1;h<e.forecast.length;h++){var m=t("<li/>",{class:"wiDay"}).html("<span>"+e.forecast[h].day+"</span>").appendTo(u),y=t("<ul/>",{class:"wiForecast"}).appendTo(m);t("<li/>",{class:"wi wi"+e.forecast[h].code}).appendTo(y),t("<li/>",{class:"wiMax"}).html(e.forecast[h].temp.max+"<sup>"+a+"</sup>").appendTo(y),t("<li/>",{class:"wiMin"}).html(e.forecast[h].temp.min+"<sup>"+a+"</sup>").appendTo(y)}u.appendTo(i)}}return t(s.element).html(i),t(s.element)}}),t.fn[c]=function(e,s){return t.isFunction(i.prototype[e])?this.data("plugin_"+c)[e](s):this.each(function(){if(!t.data(this,"plugin_"+c)){var s=new i(this,e);return t.data(this,"plugin_"+c,s)}})},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}(jQuery,window,document);